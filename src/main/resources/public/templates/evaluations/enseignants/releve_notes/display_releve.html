<!--
  ~ Copyright (c) Région Hauts-de-France, Département 77, CGI, 2016.
  ~
  ~ This file is part of OPEN ENT NG. OPEN ENT NG is a versatile ENT Project based on the JVM and ENT Core Project.
  ~
  ~ This program is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation (version 3 of the License).
  ~ For the sake of explanation, any module that communicate over native
  ~ Web protocols, such as HTTP, with OPEN ENT NG is outside the scope of this
  ~ license and could be license under its own terms. This is merely considered
  ~ normal use of OPEN ENT NG, and does not fall under the heading of "covered work".
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  ~
  -->
<div class="row">
    <header>
        <!--<h1 style="float: left;">Relevé de notes</h1>-->
        <nav class="right-magnet">
            <a class="button noMarginLeft twelve-mobile" href="/viescolaire/evaluations#/devoir/create"><i18n>evaluations.test.new</i18n></a>
            <a class="button twelve-mobile" href="#/devoirs/list"><i18n>evaluations.test.list</i18n></a>
        </nav>
    </header>

    <div class="twelve cell">
        <aside class="two cell twelve-mobile menuLeft left">
            <div class="criteres card criterion"  ng-class="{opened : opened.criteres === true}">
                <span class="plus-input" ng-click="opened.criteres = !opened.criteres"></span>
                <div class="header" ng-click="opened.criteres = !opened.criteres">
                    <h2><i18n>viescolaire.utils.criterion</i18n></h2>
                </div>
                <section>
                    <label class="select">
                        <select ng-model="search.classe" ng-change="getReleve();" ng-options="classe as classe.name group by classe.type_groupe_libelle for classe in classes.all | orderBy:['type_groupe_libelle','name']">
                            <option value="" class="header-opt">[[translate('viescolaire.utils.class.groupe')]]</option>
                        </select>
                    </label>
                </section>
                <section>
                    <label class="select">
                        <select ng-model="search.matiere" ng-change="getReleve()"
                                ng-options="matiere.name for matiere in matieres.all|unique:'name'">
                            <option value="" class="header-opt">[[translate('viescolaire.utils.subject')]]</option>
                        </select>
                    </label>
                </section>
                <section>
                    <label class="select">
                        <select ng-model="search.periode" ng-change="getReleve()" ng-options="periode.libelle for periode in periodes.all">
                            <option value="" class="header-opt">[[translate('viescolaire.utils.periode')]]</option>
                        </select>
                    </label>
                </section>
            </div>
            <div class="marginFive">
                <container class="left card tailleMax" template="leftSide-devoirInfo"></container>

                <div ng-if="!template.isEmpty('leftSide-userInfo')" class="fiche student-info card left tailleMax" ng-class="{opened : openedStudentInfo === true}">
                    <span class="plus-input" ng-click="openedStudentInfo = !openedStudentInfo"></span>
                    <container template="leftSide-userInfo"></container>
                </div>
            </div>
        </aside>

        <section class="ten twelve-mobile cell right">

            <content ng-show="releveNote.devoirs.all.length > 0">
                <div class="responsive-table overflowXScroll">
                    <table id="relevetable" class="list-view tableReleve tableRelevePadding marginTopZero" c-naviga-table>
                        <thead>
                        <tr >
                            <th class="col1"><i18n>student</i18n></th>
                            <th ng-class="{'devoir-with-comp' : devoir.nbcompetences > 0, 'ellipsis' : true }"
                                ng-repeat="devoir in releveNote.devoirs.all" ng-click="getDevoirInfo(devoir)"
                                style="display: inline-block;min-width: 80px; width: calc((83.33333%-200px)/([[releveNote.devoirs.all.length +1]]));"
                                ng-dblclick="goTo('/devoir/'+devoir.id)" tooltip="[[devoir.name]]">
                                [[getShortDateFormated(devoir.date)]]<br>
                                [[devoir.name]]
                            </th>
                            <th style="display: inline-block; width: calc((83.33333%-200px)/([[releveNote.devoirs.all.length +1]]));"
                                class="colMoyenne"><i18n>average</i18n></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="eleve in releveNote.classe.eleves.all">
                            <td class="col1 text-overflow" ng-click="getEleveInfo(eleve)">[[eleve.lastName]] [[eleve.firstName]]</td>
                            <td class="colDevoir" ng-repeat="evaluation in eleve.evaluations.all" data-label="[[getLibelleDevoir(evaluation.id_devoir)]]">
                                <input ng-focus="focusMe($event); getEleveInfo(eleve); getDevoirInfo(evaluation)"
                                       class="input-note"
                                       type="text"
                                       style="width: 5em;margin: 0 auto;"
                                       ng-model="evaluation.valeur"
                                       ng-blur="saveNoteDevoirEleve(evaluation, $event, eleve)"
                                       max="20" min="0" step="0.01">
                            </td>
                            <!--ng-init="initNoteReleve(evaluation)"-->
                            <td  class="colMoyenne" data-label="Moyenne">
                                <span style="font-weight: bold;">[[eleve.moyenne]]</span>
                            </td>

                        </tr>
                        <tr class="moyenneClasse">
                            <td class="col1 text-overflow"><i18n>viescolaire.classe.moyenne</i18n></td>
                            <td class="colDevoir" ng-repeat="devoir in releveNote.devoirs.all" data-label="[[devoir.name]]">
                                <div class="input-note">
                                    [[devoir.statistiques.moyenne]]
                                </div>
                            </td>
                            <td class="colMoyenne" data-label="Moyenne"></td>
                        </tr>
                        <tr class="minClasse">
                            <td class="col1 text-overflow"><i18n>viescolaire.classe.note.min</i18n></td>
                            <td class="colDevoir"
                                ng-repeat="devoir in releveNote.devoirs.all" data-label="[[devoir.name]]">
                                <div >
                                    [[devoir.statistiques.noteMin]]
                                </div>
                            </td>
                            <td class="colMoyenne" data-label="Moyenne"></td>
                        </tr>
                        <tr class="maxClasse">
                            <td class="col1 text-overflow"><i18n>viescolaire.classe.note.max</i18n></td>
                            <td class="colDevoir"  ng-repeat="devoir in releveNote.devoirs.all"
                                data-label="[[devoir.name]]">
                                <div class="input-note">
                                    [[devoir.statistiques.noteMax]]
                                </div>
                            </td>
                            <td class="colMoyenne" data-label="Moyenne"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </content>
            <content ng-show="releveNote.devoirs.all.length === 0">
                <h1 style="color: grey;"><i18n>evaluations.no.summary</i18n>.</h1>
            </content>
        </section>

    </div>

</div>
